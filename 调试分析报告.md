# è°ƒè¯•è¾“å‡ºåˆ†ææŠ¥å‘Š

## ğŸ“Š è°ƒè¯•è¾“å‡ºæ•°æ®

**æ¨¡å‹è¿”å›çš„ç±»åˆ«**ï¼š
- `sperm(id=0)` - 26ä¸ª
- `cluster(id=1)` - 1ä¸ª  
- `small_or_pinhead(id=2)` - 5ä¸ª

**åç«¯ç»Ÿè®¡ç»“æœ**ï¼š
- Normal (çº¢è‰²): 26 âœ…
- Cluster (ç»¿è‰²): 1 âœ…
- Pinhead (è“è‰²): 5 âœ…

**æ€»è½¨è¿¹æ•°**: 32

## âœ… åç«¯ç»Ÿè®¡é€»è¾‘ - æ­£ç¡®ï¼

åç«¯ç»Ÿè®¡é€»è¾‘å·²ç»ä¿®å¤ï¼Œç°åœ¨åŸºäºçœŸå®çš„ `class_name` ç»Ÿè®¡ï¼š
- `sperm` â†’ Normal (çº¢è‰²) âœ…
- `cluster` â†’ Cluster (ç»¿è‰²) âœ…
- `small_or_pinhead` â†’ Pinhead (è“è‰²) âœ…

ç»Ÿè®¡ç»“æœï¼š26 + 1 + 5 = 32ï¼Œä¸æ€»è½¨è¿¹æ•°ä¸€è‡´ï¼

## ğŸ” é—®é¢˜å®šä½

### é—®é¢˜ç°è±¡
- **è§†è§‰è§‚å¯Ÿ**ï¼šå›¾ç‰‡ä¸Šæœ‰ 20+ ä¸ªè“è‰²æ¡†
- **ç»Ÿè®¡æ˜¾ç¤º**ï¼šåªæœ‰ 5 ä¸ª Pinhead (è“è‰²)
- **çŸ›ç›¾**ï¼šå¦‚æœç»Ÿè®¡æ­£ç¡®ï¼Œä¸åº”è¯¥æœ‰ 20+ ä¸ªè“è‰²æ¡†

### å¯èƒ½çš„åŸå› 

#### 1. é¢„è§ˆå›¾åªæ˜¾ç¤ºç¬¬ä¸€å¸§çš„æ£€æµ‹ç»“æœ âš ï¸

åœ¨ `video_speed_tracking.py` ç¬¬203-212è¡Œï¼š
```python
if preview_path and not preview_written and len(detections):
    annotated = im0.copy()
    for bbox, cls_id in detections:
        x1, y1, x2, y2 = bbox.astype(int)
        name = names[cls_id] if cls_id < len(names) else str(cls_id)
        color = class_colors.get(name.lower(), (255, 87, 68))
        cv2.rectangle(annotated, (x1, y1), (x2, y2), color, 2)
    preview_path.parent.mkdir(parents=True, exist_ok=True)
    cv2.imwrite(str(preview_path), annotated)
    preview_written = True  # âš ï¸ åªå†™ä¸€æ¬¡ï¼Œå³ç¬¬ä¸€å¸§
```

**å…³é”®é—®é¢˜**ï¼š
- é¢„è§ˆå›¾åªä½¿ç”¨**ç¬¬ä¸€å¸§æœ‰æ£€æµ‹ç»“æœçš„å¸§**ç”Ÿæˆ
- ç»Ÿè®¡æ˜¯åŸºäº**æ‰€æœ‰å¸§çš„æ‰€æœ‰è½¨è¿¹**ï¼ˆ32ä¸ªè½¨è¿¹ï¼‰
- å¦‚æœç¬¬ä¸€å¸§æ£€æµ‹åˆ°äº†å¾ˆå¤š `sperm(id=0)`ï¼Œå®ƒä»¬åº”è¯¥æ˜¾ç¤ºä¸º**çº¢è‰²**
- ä½†å¦‚æœç”¨æˆ·çœ‹åˆ°å¾ˆå¤š**è“è‰²æ¡†**ï¼Œè¯´æ˜é¢œè‰²æ˜ å°„å¯èƒ½æœ‰é—®é¢˜

#### 2. é¢œè‰²æ˜ å°„æ£€æŸ¥

åœ¨ `video_speed_tracking.py` ç¬¬175-181è¡Œï¼š
```python
class_colors = {
    "sperm": (255, 0, 0),  # normal -> red âœ…
    "normal": (255, 0, 0),
    "cluster": (0, 255, 0),  # green âœ…
    "small_or_pinhead": (0, 128, 255),  # blue-ish âœ…
    "pinhead": (0, 128, 255),
}
```

**é¢œè‰²æ˜ å°„é€»è¾‘**ï¼ˆç¬¬207-208è¡Œï¼‰ï¼š
```python
name = names[cls_id] if cls_id < len(names) else str(cls_id)
color = class_colors.get(name.lower(), (255, 87, 68))  # é»˜è®¤æ©™è‰²
```

**å¯èƒ½çš„é—®é¢˜**ï¼š
- å¦‚æœ `names[0]` è¿”å›çš„ä¸æ˜¯ `"sperm"`ï¼Œè€Œæ˜¯å…¶ä»–åç§°ï¼ˆå¦‚ `"normal"` æˆ–å…¶ä»–ï¼‰ï¼Œé¢œè‰²æ˜ å°„å¯èƒ½å‡ºé”™
- å¦‚æœ `names[0]` è¿”å›çš„åç§°ä¸åœ¨ `class_colors` å­—å…¸ä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤é¢œè‰² `(255, 87, 68)` - **è¿™æ˜¯æ©™è‰²ï¼Œä¸æ˜¯è“è‰²ï¼**

#### 3. æ¨¡å‹ç±»åˆ«åç§°éªŒè¯

éœ€è¦ç¡®è®¤æ¨¡å‹å®é™…è¿”å›çš„ç±»åˆ«åç§°ï¼š
- `names[0]` æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥æ˜¯ `"sperm"` å—ï¼Ÿ
- `names[1]` æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥æ˜¯ `"cluster"` å—ï¼Ÿ
- `names[2]` æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥æ˜¯ `"small_or_pinhead"` å—ï¼Ÿ

## ğŸ¯ ä¸‹ä¸€æ­¥è°ƒè¯•æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ·»åŠ è°ƒè¯•è¾“å‡ºåˆ°é¢„è§ˆå›¾ç”Ÿæˆ

åœ¨ `video_speed_tracking.py` ç¬¬203-212è¡Œæ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼š

```python
if preview_path and not preview_written and len(detections):
    annotated = im0.copy()
    print(f"\n=== DEBUG: é¢„è§ˆå›¾ç”Ÿæˆ ===")
    print(f"æ¨¡å‹ç±»åˆ«åç§°åˆ—è¡¨: {names}")
    print(f"ç¬¬ä¸€å¸§æ£€æµ‹åˆ°çš„ç±»åˆ«: {[names[cls_id] if cls_id < len(names) else str(cls_id) for _, cls_id in detections]}")
    for bbox, cls_id in detections:
        x1, y1, x2, y2 = bbox.astype(int)
        name = names[cls_id] if cls_id < len(names) else str(cls_id)
        color = class_colors.get(name.lower(), (255, 87, 68))
        print(f"  cls_id={cls_id}, name='{name}', color={color}")
        cv2.rectangle(annotated, (x1, y1), (x2, y2), color, 2)
    print("="*60 + "\n")
    preview_path.parent.mkdir(parents=True, exist_ok=True)
    cv2.imwrite(str(preview_path), annotated)
    preview_written = True
```

### æ–¹æ¡ˆ2ï¼šæ£€æŸ¥æ¨¡å‹ç±»åˆ«åç§°

åœ¨ `backend_speed_service.py` æˆ– `video_speed_tracking.py` ä¸­æ·»åŠ ï¼š

```python
# åœ¨åŠ è½½æ¨¡å‹å
print(f"æ¨¡å‹ç±»åˆ«åç§°: {model.names}")
print(f"ç±»åˆ«æ•°é‡: {len(model.names)}")
```

### æ–¹æ¡ˆ3ï¼šéªŒè¯é¢œè‰²æ˜ å°„

å¦‚æœæ¨¡å‹è¿”å›çš„ç±»åˆ«åç§°ä¸æ˜¯ `"sperm"`ã€`"cluster"`ã€`"small_or_pinhead"`ï¼Œéœ€è¦ï¼š
1. æ›´æ–° `class_colors` å­—å…¸ï¼Œæ·»åŠ å®é™…çš„ç±»åˆ«åç§°
2. æˆ–è€…æ›´æ–° `mock_data.py` ä¸­çš„ç»Ÿè®¡é€»è¾‘ï¼ŒåŒ¹é…å®é™…çš„ç±»åˆ«åç§°

## ğŸ”§ å¿«é€Ÿä¿®å¤å»ºè®®

å¦‚æœç¡®è®¤æ¨¡å‹è¿”å›çš„ç±»åˆ«åç§°æ˜¯ï¼š
- `names[0] = "sperm"` âœ…
- `names[1] = "cluster"` âœ…
- `names[2] = "small_or_pinhead"` âœ…

é‚£ä¹ˆé¢œè‰²æ˜ å°„åº”è¯¥æ˜¯æ­£ç¡®çš„ã€‚é—®é¢˜å¯èƒ½åœ¨äºï¼š

1. **é¢„è§ˆå›¾æ˜¾ç¤ºçš„æ˜¯ç¬¬ä¸€å¸§ï¼Œè€Œç»Ÿè®¡æ˜¯æ‰€æœ‰å¸§** - è¿™æ˜¯æ­£å¸¸çš„ï¼Œä½†å¯èƒ½é€ æˆè§†è§‰ä¸Šçš„ä¸ä¸€è‡´
2. **å¦‚æœç¬¬ä¸€å¸§æ£€æµ‹åˆ°çš„ `sperm` å¾ˆå¤šï¼Œå®ƒä»¬åº”è¯¥éƒ½æ˜¯çº¢è‰²** - å¦‚æœçœ‹åˆ°è“è‰²ï¼Œè¯´æ˜é¢œè‰²æ˜ å°„æœ‰é—®é¢˜

## ğŸ“ æ€»ç»“

**åç«¯ç»Ÿè®¡é€»è¾‘**ï¼šâœ… å·²ä¿®å¤ï¼ŒåŸºäºçœŸå®ç±»åˆ«åç§°ç»Ÿè®¡

**éœ€è¦éªŒè¯**ï¼š
1. æ¨¡å‹å®é™…è¿”å›çš„ç±»åˆ«åç§°åˆ—è¡¨
2. é¢„è§ˆå›¾ç”Ÿæˆæ—¶çš„é¢œè‰²æ˜ å°„
3. ç¬¬ä¸€å¸§æ£€æµ‹åˆ°çš„ç±»åˆ«åˆ†å¸ƒ

**å»ºè®®**ï¼šæ·»åŠ è°ƒè¯•è¾“å‡ºï¼Œç¡®è®¤é¢„è§ˆå›¾ç”Ÿæˆæ—¶çš„ç±»åˆ«åç§°å’Œé¢œè‰²æ˜ å°„æ˜¯å¦æ­£ç¡®ã€‚

