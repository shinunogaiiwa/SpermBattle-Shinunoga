# é¢œè‰²æ˜ å°„å’Œç»Ÿè®¡ä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- è§†è§‰ä¸Šè“è‰²æ¡†ï¼ˆPinheadï¼‰å¾ˆå¤šï¼ˆ20+ï¼‰ï¼Œä½†ç»Ÿè®¡æ˜¾ç¤ºåªæœ‰5ä¸ªï¼ˆ3%ï¼‰
- æ©™è‰²æ¡†ï¼ˆClusterï¼‰åªæœ‰1-2ä¸ªï¼Œä½†ç»Ÿè®¡æ˜¾ç¤º28ä¸ªï¼ˆ15%ï¼‰
- é¢œè‰²æ˜ å°„å’Œç»Ÿè®¡å®Œå…¨ä¸ä¸€è‡´

## ğŸ” æ ¹æœ¬åŸå› 

**é—®é¢˜å®šä½**ï¼š
1. **é¢œè‰²æ˜ å°„**ï¼ˆåœ¨ `lib/ai/video_speed_tracking.py` ç¬¬175-181è¡Œï¼‰ï¼š
   - `"sperm"` æˆ– `"normal"` â†’ **çº¢è‰²** (255, 0, 0)
   - `"cluster"` â†’ **ç»¿è‰²** (0, 255, 0)
   - `"small_or_pinhead"` æˆ– `"pinhead"` â†’ **è“è‰²** (0, 128, 255)

2. **ç»Ÿè®¡é€»è¾‘é—®é¢˜**ï¼ˆåŸ `backend/app/mock_data.py` ç¬¬311-314è¡Œï¼‰ï¼š
   - âŒ **å®Œå…¨å¿½ç•¥äº†æ¨¡å‹è¿”å›çš„ `class_name`**
   - âŒ ä½¿ç”¨ç¡¬ç¼–ç çš„å›ºå®šæ¯”ä¾‹ï¼š
     - `normal_count = max(1, int(total_sperm * max(0.25, normal_ratio * 0.9)))`
     - `cluster_count = max(0, int(total_sperm * 0.15))` â† **å›ºå®š15%ï¼**
     - `pinhead_count = total_sperm - normal_count - cluster_count`

3. **ç»“æœ**ï¼šç»Ÿè®¡æ•°å­—å’Œå®é™…æ£€æµ‹ç»“æœå®Œå…¨ä¸åŒ¹é…

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶ï¼š`backend/app/mock_data.py`

**ä¿®å¤å†…å®¹**ï¼š
1. **åŸºäºçœŸå®çš„ `class_name` ç»Ÿè®¡**ï¼š
   - éå†æ‰€æœ‰ tracksï¼Œæ£€æŸ¥æ¯ä¸ª track çš„ `class_name`
   - æ ¹æ®ç±»åˆ«åç§°åŒ¹é…é¢œè‰²æ˜ å°„é€»è¾‘è¿›è¡Œç»Ÿè®¡

2. **åŒ¹é…è§„åˆ™**ï¼ˆä¸é¢œè‰²æ˜ å°„ä¸€è‡´ï¼‰ï¼š
   ```python
   # Normal (çº¢è‰²)
   if "normal" in class_name or ("sperm" in class_name and "cluster" not in class_name and "pinhead" not in class_name and "small" not in class_name):
       normal_count_raw += 1
   
   # Cluster (ç»¿è‰²)
   elif "cluster" in class_name:
       cluster_count_raw += 1
   
   # Pinhead (è“è‰²)
   elif "pinhead" in class_name or "small" in class_name:
       pinhead_count_raw += 1
   ```

3. **å›é€€æœºåˆ¶**ï¼š
   - å¦‚æœ `class_name` ä¸åŒ¹é…ï¼Œå°è¯•ä½¿ç”¨ `class_id`ï¼ˆ0=normal, 1=cluster, 2=pinheadï¼‰
   - å¦‚æœéƒ½åŒ¹é…ä¸ä¸Šï¼Œé»˜è®¤å½’ç±»ä¸º normal

4. **è°ƒè¯•è¾“å‡º**ï¼š
   - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¾ç¤ºï¼š
     - æ€»è½¨è¿¹æ•°
     - å‘ç°çš„å”¯ä¸€ç±»åˆ«åç§°
     - åŸºäº class_name çš„ç»Ÿè®¡ç»“æœ

## ğŸ“Š è°ƒè¯•è¾“å‡ºç¤ºä¾‹

ä¿®å¤åï¼Œä¸Šä¼ è§†é¢‘æ—¶ä¼šåœ¨åç«¯ç»ˆç«¯çœ‹åˆ°ï¼š

```
============================================================
=== DEBUG: ç²¾å­ç±»åˆ«ç»Ÿè®¡ ===
æ€»è½¨è¿¹æ•°: 45
å‘ç°çš„å”¯ä¸€ç±»åˆ«: ['sperm(id=0)', 'cluster(id=1)', 'pinhead(id=2)']
åŸºäº class_name ç»Ÿè®¡:
  Normal (çº¢è‰²): 20
  Cluster (ç»¿è‰²): 2
  Pinhead (è“è‰²): 23
============================================================
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

1. **é‡å¯åç«¯æœåŠ¡å™¨**ï¼š
   ```bash
   # åœæ­¢æ—§è¿›ç¨‹
   taskkill /F /IM python.exe
   
   # é‡æ–°å¯åŠ¨
   cd sperm-wars/backend
   source venv/Scripts/activate  # Windows Git Bash
   # æˆ–
   .\venv\Scripts\Activate.ps1  # PowerShell
   
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **ä¸Šä¼ è§†é¢‘**ï¼š
   - è®¿é—®å‰ç«¯ï¼šhttp://localhost:3000
   - ä¸Šä¼ ä¸€ä¸ªè§†é¢‘æ–‡ä»¶

3. **æŸ¥çœ‹è°ƒè¯•è¾“å‡º**ï¼š
   - åœ¨åç«¯ç»ˆç«¯æŸ¥çœ‹ DEBUG è¾“å‡º
   - ç¡®è®¤ç±»åˆ«åç§°å’Œç»Ÿè®¡ç»“æœ

4. **éªŒè¯ç»“æœ**ï¼š
   - æŸ¥çœ‹å‰ç«¯æ˜¾ç¤ºçš„ç»Ÿè®¡æ•°å­—
   - å¯¹æ¯”å›¾ç‰‡ä¸Šçš„é¢œè‰²æ¡†æ•°é‡
   - åº”è¯¥ç°åœ¨ä¸€è‡´äº†ï¼

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¦‚æœè°ƒè¯•è¾“å‡ºæ˜¾ç¤ºç±»åˆ«åç§°ä¸åŒ¹é…**ï¼š
   - æ£€æŸ¥æ¨¡å‹å®é™…è¿”å›çš„ `class_name` æ ¼å¼
   - å¯èƒ½éœ€è¦è°ƒæ•´åŒ¹é…è§„åˆ™ï¼ˆåœ¨ `mock_data.py` ç¬¬326-342è¡Œï¼‰

2. **å¦‚æœç»Ÿè®¡ç»“æœä»ç„¶ä¸å¯¹**ï¼š
   - æˆªå›¾è°ƒè¯•è¾“å‡ºå‘ç»™æˆ‘
   - æˆ‘ä¼šæ ¹æ®å®é™…çš„ç±»åˆ«åç§°è¿›ä¸€æ­¥è°ƒæ•´åŒ¹é…è§„åˆ™

3. **æ¨¡å‹ç±»åˆ«åç§°å¯èƒ½çš„å˜åŒ–**ï¼š
   - å¦‚æœæ¨¡å‹è®­ç»ƒæ—¶ç”¨çš„ç±»åˆ«åç§°ä¸åŒï¼ˆå¦‚ `"sperm_normal"`, `"sperm_cluster"`, `"sperm_pinhead"`ï¼‰
   - éœ€è¦ç›¸åº”è°ƒæ•´åŒ¹é…è§„åˆ™

## ğŸ”§ è¿›ä¸€æ­¥è°ƒè¯•

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥ï¼š

1. **æ£€æŸ¥æ¨¡å‹ç±»åˆ«åç§°**ï¼š
   ```python
   from ultralytics import YOLO
   model = YOLO('lib/ai/models/best.pt')
   print('æ¨¡å‹ç±»åˆ«åç§°:', model.names)
   ```

2. **æŸ¥çœ‹å®é™…çš„ track æ•°æ®**ï¼š
   åœ¨ `mock_data.py` çš„è°ƒè¯•è¾“å‡ºä¸­å·²ç»åŒ…å«äº†ç±»åˆ«ä¿¡æ¯

3. **æ‰‹åŠ¨éªŒè¯**ï¼š
   å¯¹æ¯”å›¾ç‰‡ä¸Šçš„æ¡†é¢œè‰²å’Œç»Ÿè®¡æ•°å­—ï¼Œç¡®è®¤æ˜ å°„æ˜¯å¦æ­£ç¡®

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `backend/app/mock_data.py` - ç»Ÿè®¡é€»è¾‘ï¼ˆå·²ä¿®å¤ï¼‰
- `lib/ai/video_speed_tracking.py` - é¢œè‰²æ˜ å°„å’Œæ£€æµ‹é€»è¾‘
- `frontend/components/AnnotatedImage.tsx` - å‰ç«¯æ˜¾ç¤º

